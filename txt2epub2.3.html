<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TXT→EPUB（内嵌依赖 + 自定义章节规则）</title>
<style>
body{font-family:-apple-system,Helvetica,Arial;max-width:700px;margin:20px auto;padding:16px;}
h1{text-align:center;}
label{display:block;margin:10px 0 6px;}
input[type="file"],input[type="text"]{width:100%;}
button{margin:8px 4px;padding:6px 12px;background:#0c64f2;border:none;color:#fff;border-radius:6px;}
#status{margin-top:12px;}
#err{margin-top:8px;color:#b00020;white-space:pre-wrap;}
progress{width:100%;height:14px;margin-top:10px;}
#preview{margin-top:15px;padding:10px;border:1px solid #ccc;background:#fafafa;}
</style>
</head>
<body>
<h1>TXT → EPUB</h1>

<label>书名：<input id="bookTitle" type="text" value="我的小说" /></label>
<label>章节识别规则（正则表达式）：</label>
<input id="regexInput" type="text" value="^(?:第[一二三四五六七八九十百千0-9]+[章节回卷篇]|番外|[0-9]{1,4}$)" />
<label>选择 TXT 文件：</label>
<input id="fileInput" type="file" accept=".txt,text/plain" />

<div>
<button id="previewBtn" disabled>重新预览</button>
<button id="convertBtn" disabled>转换并下载 EPUB</button>
</div>

<progress id="progress" value="0" max="100"></progress>
<div id="status">脚本加载中…</div>
<div id="err"></div>

<div id="preview" style="display:none;">
<b>前 5 章：</b>
<ol id="previewList"></ol>
<div id="chapterCount"></div>
</div>

<!-- 内嵌 JSZip.min.js -->
<script>
/*! JSZip v3.10.1 - https://stuk.github.io/jszip/ */
...（这里保留你之前粘贴的 jszip.min.js 完整源码）...
</script>

<!-- 内嵌 FileSaver.min.js -->
<script>
(function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){"use strict";function b(a,b){return"undefined"==typeof b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function d(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","